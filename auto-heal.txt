--@name Auto-Heal
--@author PrikolMen#3372
--@server

local heal = "item_healthkit"
local armor = "item_battery"

local function Create(ply, class)
    local ok, ent = pcall(prop.createSent, ply:getPos(), ply:getAngles(), class)
    if ok then
        if isValid(ent) then
            ent:setNoDraw(true)

            timer.simple(0, function()
                if isValid(ent) then
                    ent:remove()
                end
            end)
        end
    end
end

local chip, ply = chip(), owner()
chip:setNoDraw(true)

timer.create(chip:getChipName(), (prop.spawnRate() / 1000), 0, function()
    if ply:isAlive() and ply:getPos():isInWorld() then
        if (ply:getHealth() < ply:getMaxHealth()) then
            Create(ply, heal)
        end
        
        if (ply:getArmor() < ply:getMaxArmor()) then
            Create(ply, armor)
        end
    end
end)